(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"65dc1807-e548-427d-a758-a7110530ed35","Content-Type":"application/json"}};function t(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return fetch("".concat(e.baseUrl,"/").concat(t),{method:o,headers:e.headers,body:n}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function o(e,t){console.log("Новое количество лайков: ".concat(t)),document.getElementById(e).querySelector(".card__like-count").textContent=t}function n(e){var n=e.target;n.classList.toggle("card__like-button_is-active");var r,c=n.closest(".card");n.classList.contains("card__like-button_is-active")?(r=c.id,console.log("Отправка запроса добавления лайка: ".concat(r)),t("cards/likes/".concat(r),"PUT")).then((function(e){console.log("Ответ на запрос добавления лайка:"),console.log(e);var t=e.likes.length;o(c.id,t)})).catch((function(e){console.log(e)})):function(e){return console.log("Отправка запроса удаления лайка: ".concat(e)),t("cards/likes/".concat(e),"DELETE")}(c.id).then((function(e){console.log("Ответ на запрос удаления лайка:"),console.log(e);var t=e.likes.length;o(c.id,t)})).catch((function(e){console.log(e)}))}var r=document.querySelector(".places__list");function c(e){var o,n=e.target.closest(".card");(o=n.id,console.log("Отправка запроса удаления карточки: ".concat(o)),t("cards/".concat(o),"DELETE")).then((function(e){console.log("Ответ на запрос удаления карточки:"),console.log(e),r.removeChild(n)})).catch((function(e){console.log(e)}))}var l=document.querySelector("#card-template");function i(e,t,o){var r=e.name,i=e.link,u=e.likes.length,a=e._id,s=l.content.cloneNode(!0),p=s.querySelector(".card__image");if(p.src=i,p.alt=r,s.querySelector(".card__title").textContent=r,s.querySelector(".card__like-count").textContent=u,s.querySelector(".card").id=a,e.owner._id!=t){var d=s.querySelector(".card__delete-button");d.disabled=!0,d.style.display="none"}return function(e,t){return Array.from(e).some((function(e){return e._id===t}))}(e.likes,t)?(console.log("Я лайкал"),s.querySelector(".card__like-button").classList.add("card__like-button_is-active")):console.log("Я не лайкал"),s.querySelector(".card__like-button").addEventListener("click",n),s.querySelector(".card__delete-button").addEventListener("click",c),s.querySelector(".card__image").addEventListener("click",o),s}var u,a=function(e,t,o){t.validity.valid?function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)};function s(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.disabled=!1):(t.classList.add(o.inactiveButtonClass),t.disabled=!0)}function p(e){"Escape"===e.key&&f(document.querySelector(".popup_is-opened"))}function d(e){e.target===e.currentTarget&&f(e.currentTarget)}function _(e,t){e.querySelector(t.formSelector)&&function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector));s(o,e.querySelector(t.submitButtonSelector),t),o.forEach((function(o){a(e,o,t)}))}(e.querySelector(t.formSelector),t),e.classList.add("popup_is-opened"),e.addEventListener("click",d),document.addEventListener("keydown",p)}function f(e){e.classList.remove("popup_is-opened"),e.removeEventListener("click",d),document.removeEventListener("keydown",p)}var v=document.querySelector(".places__list"),y=document.querySelector(".popup_type_edit"),m=document.querySelector(".popup_type_new-card"),S=document.querySelector(".popup_type_image"),g=document.querySelector(".popup_type_avatar");y.classList.add(".popup_is-animated"),m.classList.add(".popup_is-animated"),S.classList.add(".popup_is-animated"),g.classList.add(".popup_is-animated");var q=document.querySelector(".popup__input_type_name"),h=document.querySelector(".popup__input_type_description"),L=document.querySelector(".profile__info"),C=L.querySelector(".profile__title"),E=L.querySelector(".profile__description");function k(){f(y)}document.querySelector(".profile__edit-button").addEventListener("click",(function(e){e.stopPropagation(),q.value=C.textContent,h.value=E.textContent,_(y,j)})),document.querySelector(".popup_type_edit").querySelector(".popup__close").addEventListener("click",k);var b=y.querySelector(".popup__form"),x=b.querySelector(".popup__button");b.addEventListener("submit",(function(e){e.preventDefault(),x.textContent="Сохранение...";var o=q.value,n=h.value;(function(e,o){return console.log("Отправка запроса обновления профиля: ".concat(e,", ").concat(o)),t("users/me","PATCH",JSON.stringify({name:e,about:o}))})(o,n).then((function(e){console.log("Ответ на запрос обновления профиля"),console.log(e),C.textContent=o,E.textContent=n,k()})).catch((function(e){console.log(e)})).finally((function(){x.textContent="Сохранить"}))}));var T=m.querySelector(".popup__input_type_card-name"),A=m.querySelector(".popup__input_type_url");function P(){f(m)}document.querySelector(".profile__add-button").addEventListener("click",(function(e){e.stopPropagation(),T.value="",A.value="",_(m,j)})),m.querySelector(".popup__close").addEventListener("click",P);var B=m.querySelector(".popup__form"),D=B.querySelector(".popup__button");B.addEventListener("submit",(function(e){var o,n;e.preventDefault(),D.textContent="Сохранение...",(o=T.value,n=A.value,console.log("Отправка запроса создания новой карточки"),t("cards","POST",JSON.stringify({name:o,link:n}))).then((function(e){console.log("Ответ на запрос отправки новой карточки:"),console.log(e),function(e,t,o){var n=i(e,t,o);r.insertBefore(n,r.firstChild)}(e,u,O),P()})).catch((function(e){console.log(e)})).finally((function(){D.textContent="Сохранить"}))}));var w=S.querySelector(".popup__image"),N=S.querySelector(".popup__caption");function O(e){e.stopPropagation();var t=e.target,o=t.src,n=t.closest(".card").querySelector(".card__title");w.src=o,w.alt=n.textContent,N.textContent=w.alt,_(S,j)}S.querySelector(".popup__close").addEventListener("click",(function(){f(S)}));var j={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){a(e,r,t),s(o,n,t)}))}))}(t,e)}))}(j);var J=document.querySelector(".profile__image");(console.log("Отправка запроса получения информации о пользователе"),t("users/me")).then((function(e){var t;t=e,C.textContent=t.name,E.textContent=t.about,J.src=t.avatar,console.log("Полученная информация о пользователе"),console.log(t),u=t._id})).catch((function(e){console.log(e)})),(console.log("Отправка запроса получения начальных карточек"),t("cards")).then((function(e){e.forEach((function(e){var t=i(e,u,O);console.log("Полученная карточка:"),console.log(e),v.appendChild(t)}))})).catch((function(e){console.log(e)}));var U=g.querySelector(".popup__input_type_url");function H(){f(g)}document.querySelector(".profile__image-container").addEventListener("click",(function(e){e.stopPropagation(),U.value="",_(g,j)})),g.querySelector(".popup__close").addEventListener("click",H);var z=g.querySelector(".popup__form"),G=z.querySelector(".popup__button");z.addEventListener("submit",(function(e){e.preventDefault(),G.textContent="Сохранение...";var o=U.value;J.src=o,function(e){return console.log("Отправка запроса замены аватара: ".concat(e)),t("users/me/avatar","PATCH",JSON.stringify({avatar:e}))}(o).then((function(e){console.log("Ответ на запрос замены автара:"),console.log(e),H()})).catch((function(e){console.log(e)})).finally((function(){G.textContent="Сохранить"}))}))})();